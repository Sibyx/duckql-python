# duckQL

[![codecov](https://codecov.io/gh/Sibyx/duckql-python/branch/master/graph/badge.svg)](https://codecov.io/gh/Sibyx/duckql-python)

duckQL is simple JSON-based notation for these SQL dialects:

- `psql`
- `mariadb`
- `mysql`

## Example

Here is a example of library usage.

```python
from duckql import ConvertTimezone, Count, Property, Constant, Array, Query, Join, Operator, Comparision, Limit, Order

my_query = Query(
        entity='users',
        properties=[
            Property(name='users.name', alias='users_name'),
            ConvertTimezone(
                property=Property(name='users.created_at'),
                date_from=Constant(value='+00:00'),
                date_to=Constant(value='Europe/Bratislava'),
                alias='valid_timezone'
            )
        ],
        joins=[
            Join(
                entity='transactions',
                type=Join.Type.LEFT,
                on=Operator(
                    operation=Operator.Operation.AND,
                    properties=[
                        Comparision(
                            properties=[
                                Property(name='transactions.user_id'),
                                Property(name='users.id')
                            ],
                            operation=Comparision.Operation.EQUAL
                        ),
                        Comparision(
                            properties=[
                                Property(name='transactions.creator_id'),
                                Property(name='users.id')
                            ],
                            operation=Comparision.Operation.NOT_EQUAL
                        ),
                    ]
                )
            )
        ],
        conditions=Operator(
            operation=Operator.Operation.AND,
            properties=[
                Comparision(
                    properties=[
                        Property(name='users.age'),
                        Constant(value=15)
                    ],
                    operation=Comparision.Operation.GREATER_EQUAL
                ),
                Comparision(
                    properties=[
                        Property(name='users.city'),
                        Array(
                            values=[
                                Constant(value='Martin'),
                                Constant(value='Bratislava')
                            ]
                        )
                    ],
                    operation=Comparision.Operation.IN
                )
            ]
        ),
        group=[
            Property(name='users.email'),
            Property(name='users.id')
        ],
        order=[
            Order(property=Property(name='users.surname')),
            Order(property=Property(name='users.name'), kind=Order.Direction.DESC)
        ],
        limit=Limit(limit=10, offset=4),
        alias="my_query"
    )
```

```json

```

```postgresql

```

## Motivation

## Development

Project is using [poetry](https://python-poetry.org/) and documentation is generated by
[MkDocs](https://www.mkdocs.org/). If you want to generate documentation you need to follow these simple steps
inside of your virtual environment:

1. `poetry install`
2. `mkdocs build`

Inside of your virtual environment, you can also use `mkdocs serve` to create temporary auto-reload http server with
live docs.

We use [pytest](https://docs.pytest.org/en/latest/) for unit tests and [flake8](https://flake8.pycqa.org/en/latest/)
for code-style validation. You can execute tests inside of pipenv shell using these commands:

- `pytest -v .`: executes unit tests
- `pytest -v --flake8 .`: flake8 code-style tests

---
Made with ☕️ and ❤️ by Jakub Dubec & [BACKBONE s.r.o.](https://www.backbone.sk/en/)
